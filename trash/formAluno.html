<!DOCTYPE html>
<html>

<head>
    <style>
        #bodyFormAluno {
            box-sizing: border-box;
        }

        .matAlunoContainer input[type=text],
        input[type=date],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical;
        }

        .matAlunoContainer input[type=checkbox] {
            padding: 12px;
            padding-top: 10px;
            resize: horizontal;
        }

        .matAlunoContainer label {
            padding: 12px 12px 12px 0;
            display: block;
            text-align: right;
            font-weight: bold;
        }

        .matAlunoContainer {
            border-radius: 5px;
            background-color: #f2f2f2;
            padding: 20px;
        }

        .col-2C {
            float: left;
            width: 5%;
            margin-top: 6px;
        }

        .col-2chk {
            float: left;
            width: 5%;
            margin-top: 6px;
        }

        .col-5L {
            float: left;
            width: 5%;
            margin-top: 6px;
        }

        .col-10L {
            float: left;
            width: 10%;
            margin-top: 6px;
        }

        .col-50chk {
            float: left;
            width: 50%;
            margin-top: 6px;
        }

        .col-15C {
            float: left;
            width: 15%;
            margin-top: 6px;
        }

        .col-20L {
            float: left;
            width: 20%;
            margin-top: 6px;
        }

        .col-25C {
            float: left;
            width: 25%;
            margin-top: 6px;
        }

        .col-30L {
            float: left;
            width: 30%;
            margin-top: 6px;
        }

        .col-50 {
            float: left;
            width: 50%;
            margin-top: 6px;
        }

        .col-70 {
            float: left;
            width: 70%;
            margin-top: 6px;
        }

        .col-75 {
            float: left;
            width: 75%;
            margin-top: 6px;
        }

        .col-80 {
            float: left;
            width: 80%;
            margin-top: 6px;
        }

        .col-90 {
            float: left;
            width: 90%;
            margin-top: 6px;
        }

        /* Clear floats after the columns */

        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        @media (max-width: 980px) {
            .col-50,
            .col-70,
            .col-75,
            .col-80,
            .col-90,
            input[type=submit] {
                width: 100%;
                margin-top: 0;
            }
            .col-5L,
            .col-10L,
            .col-20L {
                width: 50%;
                margin-top: 0;
            }
            .col-2C,
            .col-2chk,
            .col-10L,
            .col-15C,
            .col-20L,
            .col-25C,
            .col-30L {
                width: 50%;
                margin-top: 0;
                float: right;
            }
            .matAlunoContainer label {
                text-align: left;
            }
        }

        @media (max-width: 400px) {

            .col-5L,
            .col-10L,
            .col-20L {
                width: 100%;
                margin-top: 0;
            }
            .col-2C,
            .col-10L,
            .col-15C,
            .col-20L,
            .col-25C,
            .col-30L {
                width: 100%;
                margin-top: 0;
                float: right;
            }
        }
    </style>
</head>

<body id="bodyFormAluno">
    <div id="boxTxtFormMAlunosTitle">
        <h2 id='txtFormMatriculaAlunoTitle'></h2>
    </div>

    <script>
        if (escolaINEP == "null") {
            setupEscola(userSchools[0]);
        }
        document.getElementById('txtFormMatriculaAlunoTitle').innerHTML = 'Matricular aluno na E. M. ' +
            escolaNome;
    </script>
    <div class="matAlunoContainer">
        <form action="#" id="formMatriculaAlunos" method="post" data-parsley-validate="">
            <input type="hidden" id="docVersion" name="docVersion" value="1">
            <div class="row">
                <div class="col-10L">
                    <label for="matrícula">Matrícula:</label>
                </div>
                <div class="col-20L">
                    <input type="text" id="matrícula" name="matrícula" value="" autocomplete="off" required placeholder="0000">
                </div>
                <div class="col-10L">
                    <label for="cadastro">Cadastro:</label>
                </div>
                <div class="col-20L">
                    <input type="date" id="cadastro" name="cadastro" required="">
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="nome-completo">Nome:</label>
                </div>
                <div class="col-90">
                    <input class="form-control" autocomplete="off" required="" type="text" value="" id="nome-completo"
                        name="nome-completo" placeholder="Nome..">
                </div>
            </div>

            <div class="row">
                <div class="col-10L">
                    <label for="nascimento">Nascimento:</label>
                </div>
                <div class="col-15C">
                    <input type="date" id="nascimento" name="nascimento" onchange="calcAge();" onblur="calcAge();"
                        value="" autocomplete="off" required="">
                </div>
                <div class="col-10L">
                    <label for="idade">Idade:</label>
                </div>
                <div class="col-5L">
                    <input class="form-control" type="text" disabled=true value="" id="idade" name="idade" placeholder="0000"
                        data-parsley-type="digits" autocomplete="off">
                </div>
                <div class="col-10L">
                    <label for="sexo">Sexo:</label>
                </div>
                <div class="col-15C">
                    <select id="sexo" name="sexo">
                        <option value="masc">MASCULINO</option>
                        <option value="fem">FEMININO</option>
                        <option value="outro">OUTRO</option>
                    </select>
                </div>
                <div class="col-10L">
                    <label for="cor">Cor/Raça:</label>
                </div>
                <div class="col-10L">
                    <select id="cor" name="cor">
                        <option value="branca">BRANCA</option>
                        <option value="preta">PRETA</option>
                        <option value="parda">PARDA</option>
                        <option value="amarela">AMARELA</option>
                        <option value="indígena">INDÍGENA</option>
                        <option value="não">NÃO INFORMADA</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="nome-mãe">Nome da mãe:</label>
                </div>
                <div class="col-90">
                    <input class="form-control" type="text" value="" id="nome-mãe" name="nome-mãe" placeholder="Nome da mãe.."
                        autocomplete="off" required="">
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="nome-social">Nome social:</label>
                </div>
                <div class="col-90">
                    <input class="form-control" autocomplete="off" type="text" value="" id="nome-social" name="nome-social"
                        placeholder="Nome social..">
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="nome-pai">Nome do pai:</label>
                </div>
                <div class="col-90">
                    <input class="form-control" autocomplete="off" value="" type="text" id="nome-pai" name="nome-pai"
                        placeholder="Nome do pai..">
                </div>
            </div>
            <div class="row">
                <div class="col-20L">
                    <label for="cpf-aluno">CPF do aluno:</label>
                </div>
                <div class="col-25C">
                    <input type="text" id="cpf-aluno" name="cpf-aluno" placeholder="Somente números" value=""
                        autocomplete="off" data-parsley-validcpf="">
                </div>
            </div>
            <div class="row">
                <div class="col-20L">
                    <label for="cpf-resp">CPF do responsável:</label>
                </div>
                <div class="col-25C">
                    <input type="text" id="cpf-resp" name="cpf-resp" placeholder="Somente números" value=""
                        autocomplete="off" data-parsley-validcpf="">
                </div>
            </div>
            <br>
            <fieldset>Dados da Certidão
                <div class="row">
                    <div class="col-10L">
                        <label for="certtermo">Termo:</label>
                    </div>
                    <div class="col-10L">
                        <input type="text" id="certtermo" value="" name="certtermo" placeholder="termo" autocomplete="off">
                    </div>
                    <div class="col-5L">
                        <label for="certfolha">Folha:</label>
                    </div>
                    <div class="col-10L">
                        <input type="text" id="certfolha" name="certfolha" placeholder="folha" autocomplete="off">
                    </div>
                    <div class="col-10L">
                        <label for="certlivro">Livro:</label>
                    </div>
                    <div class="col-10L">
                        <input type="text" id="certlivro" value="" name="certlivro" placeholder="livro" autocomplete="off">
                    </div>
                    <div class="col-10L">
                        <label for="certemissao">Emissão:</label>
                    </div>
                    <div class="col-10L">
                        <input type="text" id="certemissao" name="certemissao" placeholder="data" autocomplete="off">
                    </div>
                </div>
                <div class="row">
                    <div class="col-10L">
                        <label for="certcartorio">Cartório:</label>
                    </div>
                    <div class="col-10L">
                        <input type="text" id="certcartorio" value="" name="certcartorio" placeholder="cartório"
                            autocomplete="off">
                    </div>
                    <div class="col-20L">
                        <label for="certmunicip">Munic. de nasc.:</label>
                    </div>
                    <div class="col-20L">
                        <input type="text" id="certmunicip" name="certmunicip" placeholder="município" autocomplete="off">
                    </div>
                    <div class="col-10L">
                        <label for="certUF">UF:</label>
                    </div>
                    <div class="col-10L">
                        <input type="text" id="certUF" value="" name="certUF" placeholder="UF" autocomplete="off">
                    </div>
                </div>
            </fieldset>

            <div class="row">
                <div class="col-10L">
                    <label for="telefone">Telefone:</label>
                </div>
                <div class="col-20L">
                    <input type="text" id="telefone" name="telefone" placeholder="99 99999-9999" data-parsley-pattern="^\d{2} \d{5}-\d{4}$">
                </div>
                <div class="col-10L">
                    <label for="email">Email:</label>
                </div>
                <div class="col-20L">
                    <input type="text" id="email" name="email" placeholder="aaa@bbb.com" data-parsley-type="email">
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="logradouro">Logradouro:</label>
                </div>
                <div class="col-90">
                    <input class="form-control" value="" type="text" id="logradouro" name="logradouro" placeholder="Logradouro"
                        autocomplete="off">
                </div>
            </div>
            <!-- <div class="row">
                <div class="col-10L">
                    <label for="lname">Tipo lograd.:</label>
                </div>
                <div class="col-10L">
                    <select id="tipolog" name="tipolog">
                        <option value="rua">RUA</option>
                        <option value="av">AV</option>
                        <option value="outro">OUTRO</option>
                    </select>
                </div>
            </div> -->

            <div class="row">
                <div class="col-10L">
                    <label for="nro">Nro:</label>
                </div>
                <div class="col-10L">
                    <input type="text" id="nro" value="" name="nro" placeholder="0000" autocomplete="off"
                        data-parsley-type="digits">
                </div>
                <div class="col-5L">
                    <label for="comp">Comp.:</label>
                </div>
                <div class="col-10L">
                    <input type="text" id="comp" name="comp" placeholder="Complemento">
                </div>
                <div class="col-10L">
                    <label for="localidade">Localidade:</label>
                </div>
                <div class="col-20L">
                    <input type="text" id="localidade" value="" name="localidade" placeholder="Localidade" autocomplete="off">
                </div>
                <div class="col-5L">
                    <label for="cep">CEP:</label>
                </div>
                <div class="col-10L">
                    <input type="text" id="cep" name="cep" value="69160-000" placeholder="99999-999" autocomplete="off"
                        required="" data-parsley-pattern="^\d{5}-\d{3}$">
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="classe">Classe:</label>
                </div>
                <select class="col-10L" name="classe" id="classe">
                </select>

                <div class="col-10L">
                    <label for="turno">Turno:</label>
                </div>
                <select class="col-10L" name="turno" id="turno">
                    <option value="MATUTINO">MATUTINO</option>
                    <option value="VESPERTINO">VESPERTINO</option>
                    <option value="NOTURNO">NOTURNO</option>
                </select>
            </div>

            <div class="col-10L">
                <label for="situação">Situação</label>
            </div>
            <div class="col-20L">
                <select id="situação" name="situação">
                    <option value="cursando">CURSANDO</option>
                    <option value="aprovado">APROVADO</option>
                    <option value="reprovado">REPROVADO</option>
                    <option value="desistente">DESISTENTE</option>
                    <option value="transferido">TRANSFERIDO</option>
                </select>
            </div>
            <div class="row">
                <div class="col-20L">
                    <label for="transescolar">Utiliza transporte escolar:</label>
                </div>
                <div class="col-2chk">
                    <input id="transescolar" class="w3-check" style="margin-top:5px" type="checkbox" name="transescolar"
                        value="">
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="pne">PCD:</label>
                </div>
                <div class="col-2chk">
                    <input id="pneChk" class="w3-check" style="margin-top:5px" type="checkbox" name="pne" value="">
                </div>
            </div>
            <div id="hiddenObs" style="margin-left:10%;display: none">
                <div class="row">
                    <div class="col-50chk">
                        <label for="pneAee">Recebe Atendimento Educacional Especializado (AEE):</label>
                    </div>
                    <div class="col-2chk">
                        <input id="pneAee" class="w3-check" style="margin-top:5px" type="checkbox" name="pneAee" value="">
                    </div>
                </div>
                <h5>Deficiência:</h5>
                <div class="row">
                    <label class="col-10L" for="defSensorial">Sensorial: </label>
                    <select class="col-20L" name="defSensorial" id="defSensorial">
                        <option value="NÃO">Não</option>
                        <option value="AUDITIVA">Auditiva</option>
                        <option value="VISUAL">Visual</option>
                        <option value="SURDO-CEGUEIRA">Surdo-cegueira</option>
                    </select>
                    <label class="col-10L" for="defFisica">Física: </label>
                    <select class="col-20L" name="defFisica" id="defFisica">
                        <option value="NÃO">Não</option>
                        <option value="SIM">Sim</option>
                    </select>
                    <label class="col-10L" for="defIntelectual">Intelectual: </label>
                    <select class="col-20L" name="defIntelectual" id="defIntelectual">
                        <option value="NÃO">Não</option>
                        <option value="SIM">Sim</option>
                    </select>
                </div>

                <div class="row">
                    <h5>Transtornos (Síndromes):</h5>
                    <!-- <label class="col-10L" for="transtornos">Tipo: </label> -->
                    <select class="col-20L" name="transtornos" id="transtornos">
                        <option value="NÃO">Não</option>
                        <option value="TEA">Transtornos do espectro autista</option>
                    </select>
                </div>

                <div class="row">
                    <h5>Altas habilidades / Superdotação:</h5>
                    <select class="col-20L" name="superDotados" id="superDotados" onchange="showSuperDescricao();">
                        <option value="NÃO">Não</option>
                        <option value="SIM">Sim</option>
                    </select>
                    <input style="margin:5px;display:none" value="" type="text" id="descSuperDotados" name=""
                        placeholder="Descrição das altas habilidades">
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="indígena">Indígena:</label>
                </div>
                <div class="col-2chk">
                    <input id="indígena" class="w3-check" type="checkbox" name="indígena" value="true">
                </div>
            </div>
            <div id="hiddenIndigena" style="display: none">
                <div class="row">
                    <div class="col-10L">
                        <label for="etnia">Etnia:</label>
                    </div>
                    <div class="col-10L">
                        <input type="text" id="etnia" name="etnia" placeholder="Etnia">
                    </div>
                </div>
                <div class="row">
                    <div class="col-10L">
                        <label for="nomeindígena">Nome indígena:</label>
                    </div>
                    <div class="col-90">
                        <input type="text" id="indnome" name="nome-indígena" placeholder="Nome indígena">
                    </div>
                </div>
                <div class="row">
                    <div class="col-20L">
                        <label for="nomeindígenamae">Nome ind. da mãe:</label>
                    </div>
                    <div class="col-80">
                        <input type="text" id="indnomemae" name="nome-indígena-mãe" placeholder="Nome indígena da mãe">
                    </div>
                </div>
                <div class="row">
                    <div class="col-20L">
                        <label for="nome-indígena-pai">Nome ind. do pai:</label>
                    </div>
                    <div class="col-80">
                        <input type="text" id="indnomepai" name="nome-indígena-pai" placeholder="Nome indígena do pai">
                    </div>
                </div>
                <div class="row">
                    <div class="col-10L">
                        <label for="rani">R.A.N.I:</label>
                    </div>
                    <div class="col-30L">
                        <input type="text" id="indrani" name="rani" placeholder="R.A.N.I">
                    </div>
                    <div class="col-10L">
                        <label for="lregistro">Livro reg.:</label>
                    </div>
                    <div class="col-30L">
                        <input type="text" id="indlregistro" name="l-registro" placeholder="Livro de registro">
                    </div>
                </div>
                <div class="row">
                    <div class="col-10L">
                        <label for="fregistro">Folha reg.:</label>
                    </div>
                    <div class="col-30L">
                        <input type="text" id="indfregistro" name="f-registro" placeholder="Folha de registro">
                    </div>
                    <div class="col-10L">
                        <label for="dregistro">Data reg.:</label>
                    </div>
                    <div class="col-30L">
                        <input type="date" id="inddregistro" name="d-registro" value="01/01/2000">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-10L">
                    <label for="quilombola">Quilombola:</label>
                </div>
                <div class="col-2chk">
                    <input id="quilombola" class="w3-check" type="checkbox" name="quilombola" value="true">
                </div>
            </div>
            <div id="hiddenQuilombola" style="display: none">
                <div class="row">
                    <div class="col-10L">
                        <label for="qlocalidade">Localidade:</label>
                    </div>
                    <div class="col-90">
                        <input type="text" id="qlocalidade" name="qlocalidade" placeholder="Localidade">
                    </div>
                </div>
            </div>
            <br>
            <div class="row" style="text-align:right">
                <input class="w3-btn w3-light-blue w3-round-xxlarge" id="btMatriculaFormAluno" type="submit" value="Salvar">
            </div>
        </form>
        <i class="fa fa-spin fa-8x fa-refresh loading_icon" id="loading_icon_formAluno" style="display:none"></i>
    </div>
    <h4>Importar alunos.</h4>
    <input type="file" id="filesAlunos" name="filesAlunos[]" />
    <script>
        var thisForm2 = document.getElementById("formMatriculaAlunos");
        //ECLA.listaClasses.forEach(element => {
        timeToLoadP(true, "formAluno");
        ECLA.arrs.classes.forEach(element => { //fazer mapa?
            let elemB = element;
            element = element.replace("º", "º ANO ");
            element = element.replace("EI1", "EJA 1ºSEG 1ºETA ");
            element = element.replace("EI2", "EJA 1ºSEG 2ºETA ");
            element = element.replace("EF1", "EJA 2ºSEG 1ºBLO ");
            element = element.replace("EF2", "EJA 2ºSEG 2ºBLO ");
            element = element.replace("P1", "1º PERÍODO ");
            element = element.replace("P2", "2º PERÍODO ");
            element = element.replace("MT", "MATERNAL ");
            opt = document.createElement("option");
            opt.value = elemB.toUpperCase();
            opt.innerHTML = element.toUpperCase();
            thisForm2.elements.classe.appendChild(opt);
        });
        timeToLoadP(false, "formAluno");

        var thisForm = $(".matAlunoContainer #formMatriculaAlunos");
        var thisForm2 = document.getElementById("formMatriculaAlunos");
        var todayUTC = new Date().toISOString().substr(0, 10);
        $(".matAlunoContainer #cadastro").val(todayUTC);
        $(".matAlunoContainer #cadastro").prop('disabled', true);
        $(".matAlunoContainer #nome-completo").focus();
        $(function () {
            try {
                $('#formMatriculaAlunos').parsley().on('field:validated', function () {

                        if ($(".matAlunoContainer #matrícula").val() === "auto") {
                            let tohash = removeAccents(thisForm2.elements.nascimento.value + thisForm2.elements[
                                    "nome-completo"].value + thisForm2.elements["nome-mãe"].value +
                                thisForm2.elements["nome-pai"].value + thisForm2.elements["certtermo"].value +
                                thisForm2.elements["certfolha"].value +
                                thisForm2.elements["certlivro"].value);
                            let nsigeb = Math.abs(makeHash(tohash));
                            $(".matAlunoContainer #matrícula").val(makeHash(nsigeb));
                        }
                        calcAge();
                        try {
                            var ok = $('.parsley-error').length === 0;
                        } catch (error) {
                            alert(error)
                        }
                    })
                    .on('form:submit', function () {
                        try {
                            addAluno('matriculado');
                            //online = false; //for test
                            /* if (online) { //ver
                                addAluno('matriculado');
                            } else {
                                //addAlunoOffT();
                                swal({
                                        html: true,
                                        title: 'ATENÇÃO!',
                                        text: 'Ao matricular o aluno offline os dados serão sobrescritos, sem aviso, no banco de dados quando o dispositivo ficar online.',
                                        icon: "warning",
                                        closeOnClickOutside: false,
                                        buttons: ["Cancelar", "Continuar"],
                                        dangerMode: true,
                                    })
                                    .then((doAction) => {
                                        if (doAction) {
                                            addAluno('matriculado'); //verificar conexao pra decidir
                                        } else {
                                            $.toast({
                                                text: 'Cancelado.',
                                                showHideTransition: 'slide',
                                            })
                                        }
                                    });
                            } */
                        } catch (error) {
                            alert(error);
                        }
                        return false; // Don't submit
                    });
            } catch (error) {
                alert('parsley: ' + error)
            }

        });
        $(".matAlunoContainer #pneChk").click(function () {
            $(".matAlunoContainer #hiddenObs").toggle(250);
        });

        $(".matAlunoContainer #indígena").click(function () {
            $(".matAlunoContainer #hiddenIndigena").toggle(250);
        });
        $(".matAlunoContainer #quilombola").click(function () {
            $(".matAlunoContainer #hiddenQuilombola").toggle(250);
        });

        //$(".matAlunoContainer #telefone").mask("(99) 99999-9999");
        //$(".matAlunoContainer #cep").mask("99999-999");

        document.onkeyup = function (e) {
            //console.log("kkkkk");
            if (e.keyCode == 113 && userType == "DVLP" && escolaINEP == "111.111.11") {
                //console.log("Auto preenchimento.");
                //console.log("f2");
                let bncc = gradesCurriculares.bncc.map(function (x) {
                    return x.toUpperCase();
                });
                //console.log("bncc", bncc);
                document.getElementById("sexo").selectedIndex = rndInInterv(0, 1);
                document.getElementById("cor").selectedIndex = rndInInterv(0, 5);
                document.getElementById("turno").selectedIndex = rndInInterv(0, 2);
                document.getElementById("situação").selectedIndex = rndInInterv(0, 4);
                let pne = document.getElementById("pneChk").checked = coinV();
                if (pne) {
                    dadosPCDs = {
                        /* "defSensorial": aluForm.elements["defSensorial"].value.toUpperCase(),
                        "defFisica": aluForm.elements["defFisica"].value.toUpperCase(),
                        "defIntelectual": aluForm.elements["defIntelectual"].value.toUpperCase(),
                        "transtornos": aluForm.elements["transtornos"].value.toUpperCase(),
                        "superDotados": aluForm.elements["superDotados"].value.toUpperCase(),
                        "aee": aluForm.elements["pneAee"].checked,
                        "descSuperDotados": aluForm.elements["descSuperDotados"].value.toUpperCase(), */
                    };
                }
                let indigena = document.getElementById("indígena").checked = coinV();
                if (indigena) {
                    dadosIndigenas = {
                        /* "etnia": aluForm.elements.etnia.value.toUpperCase(),
                        "nome-indígena": aluForm.elements["nome-indígena"].value.toUpperCase(),
                        "nome-indígena-mãe": aluForm.elements["nome-indígena-mãe"].value.toUpperCase(),
                        "nome-indígena-pai": aluForm.elements["nome-indígena-pai"].value.toUpperCase(),
                        "rani": aluForm.elements.rani.value.toUpperCase(),
                        "l-registro": aluForm.elements["l-registro"].value.toUpperCase(),
                        "f-registro": aluForm.elements["f-registro"].value.toUpperCase(),
                        "d-registro": aluForm.elements["d-registro"].value.toUpperCase(), */
                    };
                }
                let quilombola = document.getElementById("indígena").checked = coinV();
                if (quilombola) {
                    /*  dadosQuilombolas = {
                         "localidade": aluForm.elements.qlocalidade.value.toUpperCase(),
                     }; */
                }
                document.getElementById("transescolar").checked = coinV();
                //console.log("dados true false");
                $(".matAlunoContainer #nome-completo").val('Aluno ' + rndInInterv(1, 100000));
                let bday = Date.now() - rndInInterv(1000 * 60 * 60 * 24 * 365 * 3, 1000 * 60 * 60 * 24 * 365 * 20);
                let age = ~~((Date.now() - bday) / (31557600000));
                let dt = new Date(bday);
                var d = new Date(dt.getFullYear(), (dt.getMonth() + 1), dt.getDate()).toISOString().substr(0, 10);
                //console.log("date", d);
                let seriesOrd = seriesInOrder();
                //console.log("seriesOrd",seriesOrd);
                //alert("seriesord")
                for (let s = 0; s < seriesOrd.length; s++) { //ver
                    seriesOrd[s] = seriesOrd[s].replace("º", "º ANO ");
                    seriesOrd[s] = seriesOrd[s].replace("EI1", "EJA 1ºSEG 1ºETA ");
                    seriesOrd[s] = seriesOrd[s].replace("EI2", "EJA 1ºSEG 2ºETA ");
                    seriesOrd[s] = seriesOrd[s].replace("EF1", "EJA 2ºSEG 1ºBLO ");
                    seriesOrd[s] = seriesOrd[s].replace("EF2", "EJA 2ºSEG 2ºBLO ");
                    seriesOrd[s] = seriesOrd[s].replace("P1", "1º PERÍODO ");
                    seriesOrd[s] = seriesOrd[s].replace("P2", "2º PERÍODO ");
                    seriesOrd[s] = seriesOrd[s].replace("MT", "MATERNAL ");
                }
                //console.log("seriesOrd");
                //console.log(seriesOrd);
                // alert("seriesord")
                var letters = ["A", "B", "C"]; //pode ser melhorado
                //console.log(ECLA.arrs.series);
                //console.log(seriesOrd);
                var aclasse = document.getElementById("classe")
                var apos;
                if (age - 3 >= seriesOrd.length) {
                    apos = seriesOrd.length - 1;
                } else {
                    apos = age - 3;
                }
                var sclasse = seriesOrd[apos] + letters[rndInInterv(0, 2)];
                console.log(age + ":" + sclasse);
                aclasse.selectedIndex = [...aclasse.options]
                    .findIndex(option => option.text === sclasse);
                $(".matAlunoContainer #nascimento").val(d);
                $(".matAlunoContainer #idade").val(age);
                $(".matAlunoContainer #nome-mãe").val("Mae " + rndInInterv(1, 100000));
                $(".matAlunoContainer #logradouro").val("Logradouro");
                $(".matAlunoContainer #nro").val(12);
                $(".matAlunoContainer #localidade").val('Localidade');
                $(".matAlunoContainer #cep").val('25362-845');
                $(".matAlunoContainer #cpf-resp").val(cpf());
                $(".matAlunoContainer #matrícula").val(rndInInterv(1, 100000));
            }
            //console.log("if ctrl");
            if (e.ctrlKey) addAluno('matriculado');
        }

        function coinV() {
            if (rndInInterv(1, 10) > 9) return true;
            return false;
        }

        function calcAge(dateString) {
            try {
                let form = document.getElementById("formMatriculaAlunos");
                var birthday = +new Date(form.elements.nascimento.value);
                form.elements.idade.value = ~~((Date.now() - birthday) / (31557600000));
            } catch (error) {
                alert(error);
            }
        }

        try {
            window.ParsleyValidator
                .addValidator('validcpf', function (value, requirement) {
                    var cpf = value.replace(/[^0-9]/g, ''),
                        compareCPF = cpf.substring(0, 9),
                        add = 0,
                        i, u, invalidCPF = [
                            '00000000000',
                            '11111111111',
                            '22222222222',
                            '33333333333',
                            '44444444444',
                            '55555555555',
                            '66666666666',
                            '77777777777',
                            '88888888888',
                            '99999999999'
                        ];


                    if (cpf.length < 11 || $.inArray(cpf, invalidCPF) !== -1) {
                        return false;
                    }

                    for (i = 8, u = 2; i >= 0; i--, u++) {
                        add = add + parseInt(cpf.substring(i, i + 1)) * u;
                    }

                    compareCPF = compareCPF + ((add % 11) < 2 ? 0 : 11 - (add % 11));
                    add = 0

                    for (i = 9, u = 2; i >= 0; i--, u++) {
                        add = add + parseInt(cpf.substring(i, i + 1)) * u;
                    }

                    compareCPF = compareCPF + ((add % 11) < 2 ? 0 : 11 - (add % 11));

                    if (compareCPF !== cpf) {
                        return false;
                    }
                    return true;

                }, 32)
                .addMessage('pt-br', 'validcpf', 'Este campo deve ser um CPF válido.');
        } catch (error) {
            alert('Parsley cpf:' + error);
        }

        function removeOptions(selectbox) {
            var i;
            for (i = selectbox.options.length - 1; i >= 0; i--) {
                selectbox.remove(i);
            }
        }

        function formAlunoFocus() {
            try {
                timeToLoadP(true, "formAluno");
                let classSelect = document.getElementById("classe");
                removeOptions(classSelect);
                ECLA.arrs.classes.forEach(element => {
                    opt = document.createElement("option");
                    opt.value = element.toUpperCase();
                    opt.innerHTML = element.toUpperCase();
                    classSelect.appendChild(opt);
                });
                timeToLoadP(false, "formAluno");
            } catch (error) {
                console.log(error);
                timeToLoadP(false, "formAluno");
            }
        }

        function formAlunoOnLoad() {
            //qToast('w', 'formAluno loaded');
        }

        function showSuperDescricao(params) {
            if (document.getElementById("superDotados").value == "Sim") {
                //$(".matAlunoContainer #descSuperDotados").toggle(250);
                $(".matAlunoContainer #descSuperDotados").fadeIn(250);
            } else {
                $(".matAlunoContainer #descSuperDotados").fadeOut(250);
            }

        }
        //$(".matAlunoContainer #cpf-resp").mask("999.999.999-99");
        document.getElementById('filesAlunos').addEventListener('change', handleFileSelectAlunos, false);

        function handleFileSelectAlunos(evt) {
            //var files = evt.target.files; // FileList object
            try {
                csv = evt.target.files[0];
                var Dados = null;
                var arrAlunos = [];
                //qclp(csv);
                Papa.parse(csv, {
                    skipEmptyLines: true,
                    complete: function (results) {
                        let cores = ["NÃO", "BRANCA", "PARDA", "PRETA", "PARDA", "INDÍGENA",
                            "AMARELA",
                            "NÃO"
                        ];
                        console.log("rsts", results);
                        for (x = 1; x < results.data.length; x++) {
                            let aluno = {};
                            let dtn = results.data[x][6].split('.');
                            let bth = dtn[2] + "-" + dtn[1] + "-" + dtn[0];
                            let tohash = removeAccents(bth + results.data[x][0] + results.data[x][7] +
                                results.data[x][8] + results.data[x][9] + results.data[x][10] +
                                results
                                .data[x][11]);
                            let nsigeb = Math.abs(makeHash(tohash));
                            //alert(nsigeb);
                            let birth = +new Date(bth);
                            let idade = ~~((Date.now() - birth) / (31557600000));
                            Dados = {
                                "matrícula": nsigeb, //deve conter algo
                                "nsigeb": nsigeb, //gerado ao cadastrar
                                'nome-completo': results.data[x][0].toUpperCase(),
                                'cpf-aluno': results.data[x][1] || "",
                                'rg': results.data[x][2] || "",
                                'sexo': results.data[x][4],
                                'cor': cores[results.data[x][5]],
                                'nascimento': bth,
                                "pne": false,
                                "indígena": false,
                                "quilombola": false,
                                "idade": idade,
                                "cep": "69160-000",
                                "turno": results.data[x][22],
                                "classe": results.data[x][23],
                                'nome-mãe': results.data[x][7],
                                'nome-pai': results.data[x][8],
                                'certtermo': results.data[x][9],
                                'certfolha': results.data[x][10],
                                'certlivro': results.data[x][11],
                                'certmunicip': results.data[x][15],
                                'certUF': results.data[x][16],
                                'cadastro': new Date().toISOString().substr(0, 10),
                                "situação": "CURSANDO",
                            }
                            aluno.Atualizado = firebase.firestore.FieldValue.serverTimestamp();
                            aluno.Dados = Dados;
                            aluno.Notas = notasVazias();
                            aluno["Histórico"] = histVazio();
                            aluno.DadosPCDs = false;
                            aluno.DadosIndigenas = false;
                            aluno.DadosQuilombolas = false;
                            arrAlunos.push(aluno);
                        }
                        asyncAddAlunos(arrAlunos);
                    }
                });
            } catch (error) {
                alert(error)
            }
        }

        async function asyncAddAlunos(arrAlunos) {
            try {
                for (const itr of arrAlunos) {
                    //qclp(itr);
                    let ItemDocRef = db.collection(anoVigente + "/" + escolaINEP + "/ALUNOS").doc(
                        "" + itr.Dados.nsigeb);
                    await ItemDocRef.set(itr, {
                        merge: true
                    }).then(function () {
                        qToast("d", itr.Dados["nome-completo"]);
                    });
                }
                swal("Importaçao terminada.");
            } catch (error) {
                alert(error);
            }

        }
    </script>

</body>


</html>